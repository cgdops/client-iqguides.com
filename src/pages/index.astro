---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import Features from '../components/Features.astro';
import Footer from '../components/Footer.astro';
import ContactForm from '../components/ContactForm.astro';

// Import the JSON data. 
// If the file is empty or broken, this might import as undefined.
import contentData from '../data/site-content.json';

// --- DEFENSIVE DATA MAPPING ---
// We create a new 'safeContent' object.
// We use "?." to check if a field exists before accessing it.
// We use "||" to provide a fallback string if it is missing.

const safeContent = {
  meta: {
    // If contentData is totally missing, these will still default to strings
    title: contentData?.meta?.title || "Agency Client Site",
    description: contentData?.meta?.description || "Welcome to our website."
  },
  colors: {
    primary: contentData?.colors?.primary || "blue-600",
    secondary: contentData?.colors?.secondary || "gray-100"
  },
  hero: {
    headline: contentData?.hero?.headline || "Welcome",
    subheadline: contentData?.hero?.subheadline || "We provide excellent service.",
    ctaText: contentData?.hero?.ctaText || "Get Started",
    ctaLink: contentData?.hero?.ctaLink || "#contact"
  },
  contact: {
    email: contentData?.contact?.email || "hello@example.com",
    phone: contentData?.contact?.phone || "(555) 123-4567"
  },
  // Ensure features is always an array so .map() doesn't crash
  features: Array.isArray(contentData?.features) ? contentData.features : []
};
---

<Layout title={safeContent.meta.title} description={safeContent.meta.description}>
  <main class="antialiased text-gray-900">
    
    <Navbar company={safeContent.meta.title} contact={safeContent.contact} />
    
    <Hero 
      headline={safeContent.hero.headline} 
      subheadline={safeContent.hero.subheadline} 
      cta={safeContent.hero.ctaText} 
      color={safeContent.colors.primary}
    />
    
    {safeContent.features.length > 0 && (
      <Features features={safeContent.features} />
    )}

    <ContactForm clientName={safeContent.meta.title} />
    
    <Footer contact={safeContent.contact} />
    
  </main>
</Layout>
